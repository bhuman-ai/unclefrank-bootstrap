<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uncle Frank Intelligent Auto-Improve Monitor</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0a1a 100%);
            color: #00ff00;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        h1 {
            color: #ff6b6b;
            margin-bottom: 20px;
            text-shadow: 0 0 20px #ff6b6b;
            font-size: 32px;
            text-align: center;
        }
        
        .status-bar {
            background: rgba(26, 26, 26, 0.9);
            border: 2px solid #00ff00;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0, 255, 0, 0.2);
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .status-dot {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .status-dot.running {
            background: radial-gradient(circle, #00ff00, #00aa00);
            box-shadow: 0 0 20px #00ff00;
        }
        
        .status-dot.stopped {
            background: radial-gradient(circle, #ff4444, #aa0000);
            box-shadow: 0 0 20px #ff4444;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        button {
            background: rgba(26, 26, 26, 0.9);
            color: #00ff00;
            border: 2px solid #00ff00;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-size: 14px;
            transition: all 0.3s;
            margin: 0 5px;
        }
        
        button:hover {
            background: #00ff00;
            color: #0a0a0a;
            box-shadow: 0 0 20px #00ff00;
            transform: translateY(-2px);
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .panel {
            background: rgba(26, 26, 26, 0.9);
            border: 2px solid #333;
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        
        .panel h2 {
            color: #00ff00;
            margin-bottom: 15px;
            font-size: 20px;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .log-viewer {
            background: #0a0a0a;
            padding: 15px;
            border-radius: 8px;
            font-size: 13px;
            line-height: 1.6;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
        }
        
        .gap-analysis {
            display: grid;
            gap: 10px;
        }
        
        .gap-item {
            background: rgba(10, 10, 10, 0.7);
            border-left: 4px solid #ffaa00;
            padding: 10px 15px;
            border-radius: 4px;
            transition: all 0.3s;
        }
        
        .gap-item:hover {
            background: rgba(20, 20, 20, 0.9);
            transform: translateX(5px);
        }
        
        .gap-type {
            color: #ffaa00;
            font-weight: bold;
            font-size: 11px;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        
        .gap-desc {
            color: #ffffff;
            font-size: 14px;
        }
        
        .task-queue {
            display: grid;
            gap: 10px;
        }
        
        .task-item {
            background: rgba(10, 10, 10, 0.7);
            border-left: 4px solid #00aaff;
            padding: 10px 15px;
            border-radius: 4px;
            transition: all 0.3s;
        }
        
        .task-item.in-progress {
            border-left-color: #00ff00;
            animation: processing 2s infinite;
        }
        
        @keyframes processing {
            0%, 100% { background: rgba(10, 10, 10, 0.7); }
            50% { background: rgba(0, 255, 0, 0.1); }
        }
        
        .task-title {
            color: #00aaff;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .checkpoint {
            color: #888;
            font-size: 12px;
            margin-left: 20px;
            margin-top: 3px;
        }
        
        .checkpoint.pass {
            color: #00ff00;
        }
        
        .checkpoint.fail {
            color: #ff4444;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: rgba(26, 26, 26, 0.9);
            border: 2px solid #333;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #00ff00;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #888;
            font-size: 12px;
            text-transform: uppercase;
        }
        
        .timestamp {
            color: #666;
            font-size: 11px;
        }
        
        .error { color: #ff4444; }
        .success { color: #00ff00; }
        .warning { color: #ffaa00; }
        .info { color: #00aaff; }
        
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #00ff00;
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #00aa00;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß† Uncle Frank Intelligent Auto-Improve Monitor</h1>
        
        <div class="status-bar">
            <div class="status-indicator">
                <div class="status-dot stopped" id="statusDot"></div>
                <span id="statusText" style="font-size: 18px;">Checking status...</span>
                <span class="timestamp" id="lastUpdate"></span>
            </div>
            
            <div>
                <button onclick="refreshStatus()">üîÑ Refresh</button>
                <button onclick="viewLogs()">üìã View Logs</button>
                <button onclick="clearDisplay()">üóëÔ∏è Clear Display</button>
            </div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="iterationCount">0</div>
                <div class="stat-label">Iterations</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="gapCount">0</div>
                <div class="stat-label">Gaps Found</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="taskCount">0</div>
                <div class="stat-label">Tasks Created</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="successRate">0%</div>
                <div class="stat-label">Success Rate</div>
            </div>
        </div>
        
        <div class="main-grid">
            <div class="panel">
                <h2>üéØ Gap Analysis (Auto-discovered)</h2>
                <div class="gap-analysis" id="gapAnalysis">
                    <div style="color: #888; text-align: center; padding: 20px;">
                        Waiting for gap analysis...
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <h2>üìã Task Queue</h2>
                <div class="task-queue" id="taskQueue">
                    <div style="color: #888; text-align: center; padding: 20px;">
                        No tasks in queue...
                    </div>
                </div>
            </div>
        </div>
        
        <div class="panel">
            <h2>üìä Recent Activity</h2>
            <div class="log-viewer" id="activityLog">
                Waiting for activity logs...
            </div>
        </div>
    </div>
    
    <script>
        let autoRefresh = null;
        let mockData = {
            iteration: 1,
            gaps: [],
            tasks: [],
            logs: []
        };
        
        async function refreshStatus() {
            try {
                // Fetch real data from server
                const response = await fetch('https://uncle-frank-claude.fly.dev/api/monitor/intelligent-status');
                let data;
                
                if (response.ok) {
                    data = await response.json();
                } else {
                    // Use mock data or parse from logs
                    data = await parseFromLogs();
                }
                
                updateUI(data);
                
            } catch (error) {
                console.error('Error fetching status:', error);
                // Try to parse from logs as fallback
                parseFromLogs().then(updateUI);
            }
        }
        
        async function parseFromLogs() {
            // Parse the intelligent auto-improve logs
            try {
                const response = await fetch('https://uncle-frank-claude.fly.dev/api/monitor/status');
                const data = await response.json();
                
                const logs = data.logs || '';
                const lines = logs.split('\n');
                
                let parsed = {
                    running: data.running,
                    iteration: 0,
                    gaps: [],
                    tasks: [],
                    logs: []
                };
                
                lines.forEach(line => {
                    // Parse iteration number
                    const iterMatch = line.match(/ITERATION (\d+)/);
                    if (iterMatch) {
                        parsed.iteration = parseInt(iterMatch[1]);
                    }
                    
                    // Parse gap count
                    const gapMatch = line.match(/Found (\d+) gaps/);
                    if (gapMatch) {
                        parsed.gapCount = parseInt(gapMatch[1]);
                    }
                    
                    // Parse individual gaps
                    const gapTypeMatch = line.match(/- (missing_\w+): (.+)/);
                    if (gapTypeMatch) {
                        parsed.gaps.push({
                            type: gapTypeMatch[1],
                            description: gapTypeMatch[2]
                        });
                    }
                    
                    // Parse task count
                    const taskMatch = line.match(/Generated (\d+) tasks/);
                    if (taskMatch) {
                        parsed.taskCount = parseInt(taskMatch[1]);
                    }
                    
                    // Parse current task
                    const executingMatch = line.match(/Executing top priority task: (.+)/);
                    if (executingMatch) {
                        parsed.currentTask = executingMatch[1];
                    }
                    
                    // Add to activity log
                    if (line.includes('[2025-') || line.includes('[2024-')) {
                        parsed.logs.push(line);
                    }
                });
                
                return parsed;
                
            } catch (error) {
                console.error('Error parsing logs:', error);
                return mockData;
            }
        }
        
        function updateUI(data) {
            // Update status indicator
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            
            if (data.running) {
                statusDot.className = 'status-dot running';
                statusText.innerHTML = '‚úÖ System Running - Iteration ' + (data.iteration || 0);
                statusText.className = 'success';
            } else {
                statusDot.className = 'status-dot stopped';
                statusText.innerHTML = '‚ùå System Stopped';
                statusText.className = 'error';
            }
            
            // Update stats
            document.getElementById('iterationCount').textContent = data.iteration || 0;
            document.getElementById('gapCount').textContent = data.gapCount || data.gaps?.length || 0;
            document.getElementById('taskCount').textContent = data.taskCount || data.tasks?.length || 0;
            
            // Calculate success rate (mock for now)
            const totalTasks = (data.iteration || 0) * 5;
            const successRate = totalTasks > 0 ? Math.round((totalTasks - (data.gapCount || 13)) / totalTasks * 100) : 0;
            document.getElementById('successRate').textContent = successRate + '%';
            
            // Update gap analysis
            const gapAnalysis = document.getElementById('gapAnalysis');
            if (data.gaps && data.gaps.length > 0) {
                gapAnalysis.innerHTML = data.gaps.slice(0, 10).map(gap => `
                    <div class="gap-item">
                        <div class="gap-type">${gap.type.replace('_', ' ').toUpperCase()}</div>
                        <div class="gap-desc">${gap.description}</div>
                    </div>
                `).join('');
            }
            
            // Update task queue
            const taskQueue = document.getElementById('taskQueue');
            if (data.currentTask) {
                taskQueue.innerHTML = `
                    <div class="task-item in-progress">
                        <div class="task-title">üöÄ ${data.currentTask}</div>
                        <div class="checkpoint">‚è≥ Executing via Claude queue...</div>
                    </div>
                `;
            } else if (data.tasks && data.tasks.length > 0) {
                taskQueue.innerHTML = data.tasks.slice(0, 5).map(task => `
                    <div class="task-item">
                        <div class="task-title">${task.title}</div>
                        ${task.checkpoints ? task.checkpoints.map(cp => 
                            `<div class="checkpoint">‚Ä¢ ${cp.description}</div>`
                        ).join('') : ''}
                    </div>
                `).join('');
            }
            
            // Update activity log
            const activityLog = document.getElementById('activityLog');
            if (data.logs && data.logs.length > 0) {
                activityLog.innerHTML = data.logs.slice(-20).reverse().map(log => 
                    log.replace(/\[(\d{4}-\d{2}-\d{2}T[\d:\.Z]+)\]/g, '<span class="timestamp">[$1]</span>')
                       .replace(/‚úÖ/g, '<span class="success">‚úÖ</span>')
                       .replace(/‚ùå/g, '<span class="error">‚ùå</span>')
                       .replace(/üéØ/g, 'üéØ')
                       .replace(/üìã/g, 'üìã')
                       .replace(/üîß/g, 'üîß')
                ).join('\n');
            }
            
            // Update last update time
            document.getElementById('lastUpdate').textContent = 
                'Last checked: ' + new Date().toLocaleTimeString();
        }
        
        function viewLogs() {
            window.open('https://uncle-frank-claude.fly.dev/api/monitor/logs', '_blank');
        }
        
        function clearDisplay() {
            document.getElementById('gapAnalysis').innerHTML = '<div style="color: #888; text-align: center; padding: 20px;">Display cleared</div>';
            document.getElementById('taskQueue').innerHTML = '<div style="color: #888; text-align: center; padding: 20px;">Display cleared</div>';
            document.getElementById('activityLog').textContent = 'Display cleared';
        }
        
        // Start auto-refresh
        refreshStatus();
        autoRefresh = setInterval(refreshStatus, 5000);
        
        // Clean up on page unload
        window.addEventListener('beforeunload', () => {
            if (autoRefresh) clearInterval(autoRefresh);
        });
    </script>
</body>
</html>